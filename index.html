<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco Sorting Battle - ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');
        body { font-family: 'Kanit', sans-serif; }
        .btn-hover:active { transform: scale(0.95); }
        .update-flash { animation: flash 0.5s ease-out; }
        @keyframes flash {
            0% { background-color: rgba(16, 185, 129, 0.2); }
            100% { background-color: transparent; }
        }
    </style>
</head>
<body class="bg-emerald-50 min-h-screen flex flex-col items-center p-4">

    <!-- Header -->
    <header class="text-center my-6">
        <h1 class="text-4xl font-bold text-emerald-800 flex items-center justify-center gap-2">
            üå± Eco Sorting Battle
        </h1>
        <p class="text-emerald-600 mt-2 text-sm md:text-base italic">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• my-education-app ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
    </header>

    <!-- Main Container -->
    <main class="w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden p-6 relative border-b-8 border-emerald-200">
        
        <!-- Login Screen -->
        <div id="login-screen" class="space-y-6">
            <div class="text-center">
                <div class="text-6xl mb-4">‚ôªÔ∏è</div>
                <h2 class="text-2xl font-semibold text-gray-800">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏£‡∏¥‡∏á</h2>
                <p class="text-gray-500">‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏±‡∏ö Firebase</p>
            </div>
            <input type="text" id="player-name" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." 
                class="w-full px-4 py-3 border-2 border-emerald-100 rounded-xl focus:border-emerald-500 outline-none text-lg">
            <button id="btn-start"
                class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 rounded-xl text-xl shadow-lg btn-hover transition-all">
                ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏Å‡∏°
            </button>
            
            <!-- Live Leaderboard Section -->
            <div class="mt-8 border-t pt-4 bg-gray-50 -mx-6 px-6 pb-6">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-emerald-800">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏ö‡∏ö Real-time</h3>
                    <span id="status-tag" class="flex items-center gap-1 text-[10px] text-gray-400 font-bold uppercase tracking-wider">
                        <span id="status-dot" class="w-2 h-2 bg-gray-400 rounded-full"></span> 
                        <span id="status-text">Connecting</span>
                    </span>
                </div>
                <div id="leaderboard-list" class="space-y-2">
                    <p class="text-center text-gray-400 text-sm italic">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</p>
                </div>
            </div>
        </div>

        <!-- Game Screen (Hidden) -->
        <div id="game-screen" class="hidden space-y-6">
            <div class="flex justify-between items-center bg-emerald-100 p-3 rounded-2xl border border-emerald-200">
                <div class="text-lg font-bold text-emerald-800">‚è±Ô∏è <span id="timer">60</span> s</div>
                <div class="text-lg font-bold text-emerald-800">‚≠êÔ∏è ‡πÅ‡∏ï‡πâ‡∏°: <span id="score">0</span></div>
            </div>

            <div id="item-container" class="py-12 px-4 flex flex-col items-center justify-center bg-gray-50 rounded-2xl border-2 border-dashed border-emerald-200 text-center min-h-[220px]">
                <div id="item-emoji" class="text-7xl mb-4 animate-bounce">üì¶</div>
                <h2 id="item-name" class="text-3xl font-bold text-gray-800 leading-tight">...</h2>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button id="btn-recycle" class="bg-blue-500 text-white p-4 rounded-2xl font-bold btn-hover shadow-md">üîµ ‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•</button>
                <button id="btn-organic" class="bg-green-500 text-white p-4 rounded-2xl font-bold btn-hover shadow-md">üü¢ ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå</button>
                <button id="btn-hazard" class="bg-yellow-500 text-white p-4 rounded-2xl font-bold btn-hover shadow-md border-b-4 border-yellow-700">üü° ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢</button>
                <button id="btn-general" class="bg-gray-500 text-white p-4 rounded-2xl font-bold btn-hover shadow-md">‚ö´ ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="result-modal" class="hidden absolute inset-0 bg-white bg-opacity-95 flex flex-col items-center justify-center p-6 text-center z-50">
            <div class="text-6xl mb-4">üèÖ</div>
            <h2 class="text-3xl font-bold text-emerald-800 mb-2">‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á!</h2>
            <p id="final-stats" class="text-xl text-gray-600 mb-6 font-semibold"></p>
            <button onclick="location.reload()" class="bg-emerald-600 text-white px-10 py-3 rounded-full font-bold shadow-lg hover:bg-emerald-700">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // --- 1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ---
        const firebaseConfig = {
            apiKey: "AIzaSyA5DmgQGt7shLyB-ni89tv8WEgx4Ikv_A4",
            authDomain: "my-education-app-56791.firebaseapp.com",
            projectId: "my-education-app-56791",
            storageBucket: "my-education-app-56791.firebasestorage.app",
            messagingSenderId: "784125477428",
            appId: "1:784125477428:web:51df7a5db8fda352114061",
            measurementId: "G-4E1P7E6WRJ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î ID ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firestore
        const appId = "my-education-app-56791";

        let currentUser = null;
        let score = 0;
        let timeLeft = 60;
        let currentItem = null;
        let timerInterval = null;
        let playerName = "";

        const items = [
            // ‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏• (üîµ recycle)
            { name: "‡∏Ç‡∏ß‡∏î‡∏ô‡πâ‡∏≥‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å", type: "recycle", emoji: "üß¥" },
            { name: "‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°", type: "recycle", emoji: "ü•§" },
            { name: "‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏Å‡πà‡∏≤", type: "recycle", emoji: "üì∞" },
            { name: "‡∏Ç‡∏ß‡∏î‡πÅ‡∏Å‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡πà‡∏≤", type: "recycle", emoji: "üçæ" },
            { name: "‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏•‡∏±‡∏á", type: "recycle", emoji: "üì¶" },
            { name: "‡πÅ‡∏ú‡πà‡∏ô‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ü‡∏≠‡∏¢‡∏•‡πå", type: "recycle", emoji: "üåØ" },
            { name: "‡∏ô‡∏¥‡∏ï‡∏¢‡∏™‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏≤", type: "recycle", emoji: "üìö" },
            { name: "‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°", type: "recycle", emoji: "ü•´" },

            // ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå (üü¢ organic)
            { name: "‡πÄ‡∏®‡∏©‡∏ú‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡πÑ‡∏°‡πâ", type: "organic", emoji: "ü•¨" },
            { name: "‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏Ç‡πà", type: "organic", emoji: "ü•ö" },
            { name: "‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏ß‡∏¢", type: "organic", emoji: "üçå" },
            { name: "‡∏Å‡πâ‡∏≤‡∏á‡∏õ‡∏•‡∏≤", type: "organic", emoji: "üêü" },
            { name: "‡πÄ‡∏®‡∏©‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå", type: "organic", emoji: "üçó" },
            { name: "‡πÉ‡∏ö‡πÑ‡∏°‡πâ‡πÅ‡∏´‡πâ‡∏á", type: "organic", emoji: "üçÇ" },
            { name: "‡πÅ‡∏Å‡∏ô‡∏™‡∏±‡∏ö‡∏õ‡∏∞‡∏£‡∏î", type: "organic", emoji: "üçç" },
            { name: "‡πÄ‡∏®‡∏©‡∏´‡∏ç‡πâ‡∏≤", type: "organic", emoji: "üå±" },

            // ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ (üü° hazard)
            { name: "‡∏ñ‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏â‡∏≤‡∏¢", type: "hazard", emoji: "üîã" },
            { name: "‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü‡πÄ‡∏Å‡πà‡∏≤", type: "hazard", emoji: "üí°" },
            { name: "‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á‡∏™‡πÄ‡∏õ‡∏£‡∏¢‡πå", type: "hazard", emoji: "üí®" },
            { name: "‡∏¢‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏", type: "hazard", emoji: "üíä" },
            { name: "‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠", type: "hazard", emoji: "üì±" },
            { name: "‡πÅ‡∏ú‡∏á‡∏ß‡∏á‡∏à‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", type: "hazard", emoji: "üìü" },
            { name: "‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á‡∏™‡∏µ‡πÄ‡∏Å‡πà‡∏≤", type: "hazard", emoji: "üé®" },
            { name: "‡∏Ç‡∏ß‡∏î‡∏¢‡∏≤‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥", type: "hazard", emoji: "üß™" },

            // ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‚ö´ general)
            { name: "‡∏ã‡∏≠‡∏á‡∏Ç‡∏ô‡∏°‡∏Ç‡∏ö‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß", type: "general", emoji: "üçü" },
            { name: "‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÇ‡∏ü‡∏°‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô", type: "general", emoji: "üç±" },
            { name: "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏¥‡∏ä‡∏ä‡∏π‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß", type: "general", emoji: "üßª" },
            { name: "‡∏´‡∏•‡∏≠‡∏î‡∏î‡∏π‡∏î‡∏ô‡πâ‡∏≥‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å", type: "general", emoji: "ü•§" },
            { name: "‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢", type: "general", emoji: "üò∑" },
            { name: "‡∏ã‡∏≠‡∏á‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ", type: "general", emoji: "üçú" },
            { name: "‡∏´‡∏ô‡∏±‡∏á‡∏¢‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô", type: "general", emoji: "‚û∞" },
            { name: "‡∏ñ‡∏∏‡∏á‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£", type: "general", emoji: "üõçÔ∏è" }
        ];

        const startGame = () => {
            const name = document.getElementById('player-name').value.trim();
            if (!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
            playerName = name;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            nextItem();
            startTimer();
        };

        function nextItem() {
            currentItem = items[Math.floor(Math.random() * items.length)];
            document.getElementById('item-name').innerText = currentItem.name;
            document.getElementById('item-emoji').innerText = currentItem.emoji;
        }

        const checkAnswer = (type) => {
            const container = document.getElementById('item-container');
            if (type === currentItem.type) {
                score += 10;
                flashEffect(container, 'bg-green-100');
            } else {
                score = Math.max(0, score - 5);
                flashEffect(container, 'bg-red-100');
            }
            document.getElementById('score').innerText = score;
            nextItem();
        };

        function flashEffect(el, colorClass) {
            el.classList.remove('bg-gray-50');
            el.classList.add(colorClass);
            setTimeout(() => {
                el.classList.remove(colorClass);
                el.classList.add('bg-gray-50');
            }, 200);
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        async function endGame() {
            clearInterval(timerInterval);
            document.getElementById('final-stats').innerText = `‡∏Ñ‡∏∏‡∏ì ${playerName} ‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
            document.getElementById('result-modal').classList.remove('hidden');
            
            if (currentUser) {
                try {
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Path: artifacts/my-education-app-56791/public/data/scores
                    const ref = collection(db, 'artifacts', appId, 'public', 'data', 'scores');
                    await addDoc(ref, { 
                        name: playerName, 
                        score, 
                        timestamp: serverTimestamp(),
                        uid: currentUser.uid 
                    });
                } catch (e) { console.error("Error saving score:", e); }
            }
        }

        function setupLeaderboard() {
            const ref = collection(db, 'artifacts', appId, 'public', 'data', 'scores');
            
            onSnapshot(ref, (snap) => {
                updateStatus(true);
                const list = document.getElementById('leaderboard-list');
                let rawData = [];
                snap.forEach(doc => rawData.push(doc.data()));
                
                const bestScores = {};
                rawData.forEach(r => {
                    if (!bestScores[r.name] || r.score > bestScores[r.name].score) bestScores[r.name] = r;
                });

                const sorted = Object.values(bestScores).sort((a, b) => b.score - a.score).slice(0, 5);

                if (sorted.length === 0) {
                    list.innerHTML = '<p class="text-center text-gray-400 text-xs italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏ó‡∏≥‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢!</p>';
                    return;
                }

                list.innerHTML = sorted.map((s, i) => `
                    <div class="flex justify-between items-center bg-white p-3 rounded-xl border border-emerald-100 shadow-sm update-flash">
                        <span class="font-bold text-emerald-800">#${i + 1} ${s.name}</span>
                        <span class="bg-emerald-600 text-white px-3 py-1 rounded-full font-bold text-sm">${s.score}</span>
                    </div>
                `).join('');
            }, (error) => {
                updateStatus(false);
                console.error("Leaderboard error:", error);
            });
        }

        function updateStatus(online) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            const tag = document.getElementById('status-tag');
            if (online) {
                dot.className = "w-2 h-2 bg-red-500 rounded-full animate-pulse";
                text.innerText = "Live Online";
                tag.classList.replace('text-gray-400', 'text-emerald-600');
            } else {
                dot.className = "w-2 h-2 bg-gray-400 rounded-full";
                text.innerText = "Offline/Error";
                tag.classList.replace('text-emerald-600', 'text-gray-400');
            }
        }

        document.getElementById('btn-start').onclick = startGame;
        document.getElementById('btn-recycle').onclick = () => checkAnswer('recycle');
        document.getElementById('btn-organic').onclick = () => checkAnswer('organic');
        document.getElementById('btn-hazard').onclick = () => checkAnswer('hazard');
        document.getElementById('btn-general').onclick = () => checkAnswer('general');

        window.onload = async () => {
            // ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Login ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            try {
                await signInAnonymously(auth);
            } catch (e) { console.error("Anonymous login error:", e); }

            onAuthStateChanged(auth, user => {
                currentUser = user;
                if (user) setupLeaderboard();
            });
        };
    </script>
</body>
</html>